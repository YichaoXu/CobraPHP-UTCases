**Project**: Online Bus Booking System

**Vulnerability Type**: SQL Injection

**CVE link**: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-25273

** Version ** Latest vulnerable version downloaded: 16/04/2021


## Patterns

1. [P70 - Extract function](https://github.com/GiuliCler/testability_tarpits/tree/main/PHP/Testability_Patterns/70_extract)  (T3 transformation)
```php
$arr = array("A"=>"AAA","B"=>"BBB");
extract($arr);
echo $A . $B;
// output 'AAABBB'
```

## Tools

- _Comm_1_:
  - no discovery of the vulnerability

## The vulnerability on the code

The data flow for this vulnerability connects:
- source: `$_POST`, file `login_auth.php`, line 5
- sinks: `$qry = $conn->query("SELECT * FROM users where username='$username' and password = '$password' ");`, file `login_auth.php` lines 6

Hereafter the steps of the data flow:

1. The source `$_POST` is passed to the extract function, which create variables dynamically (for each element the array: the key of the element is the name of the variable, the value of the element is the value of the variable).
```php
// In the file login_auth.php
extract($_POST);
```

2. The variables `$username` and `$password` are generated from the extract function and passed tp the database.
```php
// In the file login_auth.php
$qry = $conn->query("SELECT * FROM users where username='$username' and password = '$password' ");
```

## Transformations
One transformations need to be done to enable the tool in detecting the vulnerability.

1. Change the dynamic creation of the variables to static variables 
- The following code
```php
extract($_POST);
```

- ...is transformed into:
```php
$username = $_POST["username"];
$password= $_POST["password"];
```

## Results

There are 12 `extract` functions in the project. These 12 functions create 36 variables dynamically from `$_POST` array.

**Discovery**:

**47 NEW Vulnerabilities discovered after transformation**

Comm_1 reports 49 SQL injection. 

After checking them manually, 1 of them are the vulnerabilities which are reported in the CVE.

And 48 SQL injections are True Positives.

```